const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ChkERRMK.js","assets/index-DJOjDjNm.js","assets/index-tnu9KmnZ.css","assets/MultiSelectField-BOOAz4Kk.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-DvKehNDS.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/TagsAddConfirmationModal-BvQqtTAQ.js","assets/ModalTablePagination-xuzj123i.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useGetTags-BL2WiTMt.js","assets/useRoles-BIOocaCJ.js","assets/AssociationBlock-vsPH8fvb.css","assets/index-ByjDWLMw.js","assets/ScriptsTabs-I-LlyxrQ.js","assets/constants-WmFl1fxe.js","assets/HeaderWithSearch-_Iy_BKXs.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-wAeUE9af.js","assets/ScriptsTabs-DN44MVZt.css","assets/useRunScript-CsgJr234.js","assets/DeliveryBlock-B3poVzVo.js","assets/RadioGroup-D0CCsm75.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-Dj6vGYd2.js","assets/downshift.esm-CBHt8kb_.js","assets/ScriptDropdown-DGqiHs-J.css","assets/index-B9eQQEFh.js","assets/CodeEditor-z2ks1pSD.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-D7We74eX.js","assets/AttachmentFile-DGQdklb_.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BGtsiugz.js","assets/EmployeeList-xmuOKkbH.js","assets/EmployeeList-CnpN88if.css","assets/useGetEmployees-jbBbNmSO.js","assets/index-CzWO0kSt.css","assets/index-gu1vgeKN.js","assets/SidePanelTablePagination-C1Gb5M5S.js","assets/Chip-CLo8kHiQ.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-BwDak3QZ.js","assets/useRemoveInstancesFromLandscape-bE_SA9Vl.js","assets/WslInstancesEmptyState-DlgBmoCK.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{h as O,o as be,p as ve,q as xe,R as c,j as t,S as ge,F as _e,aw as Ie,G as je,k as Se,C as f,f as we,x as Ce,_ as Fe,y as ke,w as Ae,K as Re,aO as Me,aP as De,a5 as p,z as Pe,c as y,aQ as Te,i as o,aI as l,P as Ee,W as g,O as s,aR as T,X as E,B as L,a6 as Le,t as u,a3 as _}from"./index-DJOjDjNm.js";import{C as Oe}from"./Chip-CLo8kHiQ.js";import"./EmployeeList-xmuOKkbH.js";import{u as ze,I as Be}from"./InstanceRemoveFromLandscapeModal-BwDak3QZ.js";import{u as $e}from"./useRoles-BIOocaCJ.js";import"./index-wAeUE9af.js";import{W as Ve,a as qe}from"./WslInstancesEmptyState-DlgBmoCK.js";const Ne=()=>{const e=O(),n=be(),{mutateAsync:m,isPending:h}=ve({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:d,computer_id:r})=>e.delete(`employees/${d}/computers/${r}`),onSuccess:(d,r)=>{n.invalidateQueries({queryKey:["instances",r.computer_id]})}});return{disassociateEmployeeFromInstance:m,isDisassociating:h}},Ge=(e,n={})=>{const m=O(),{id:h,...d}=e,{data:r,isLoading:b}=xe({queryKey:["employees","employee",e],queryFn:async()=>m.get(`employees/${h}`,{params:d}),...n});return{employee:r?.data,isGettingEmployee:b}},Ue=e=>{switch(e.type){case"package":return c.profiles.package({sidePath:["view"],profile:e.name||""});case"reboot":return c.profiles.reboot({sidePath:["view"],profile:e.id.toString()||""});case"removal":return c.profiles.removal({sidePath:["view"],profile:e.id.toString()||""});case"repository":return c.profiles.repository({search:e.title||""});case"script":return c.scripts.root({tab:"profiles",sidePath:["view"],profile:e.id.toString()||""});case"security":return c.profiles.security({sidePath:["view"],profile:e.id.toString()||""});case"upgrade":return c.profiles.upgrade({sidePath:["view"],profile:e.id.toString()||""});case"wsl":return c.profiles.wsl({sidePath:["view"],profile:e.name||""})}},Qe=({profile:e})=>t.jsx(ge,{to:Ue(e),children:e.title}),We={deliver_after:"",deliverImmediately:!0,action:null},Ye=_e().shape({deliver_after:Se().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:n=>f(n).isValid()}).test({message:"Date must be in the future",test:n=>f(n).isAfter()})}),deliverImmediately:je(),action:Ie().oneOf(["shutdown","reboot"]).required()}),Ke="_headerContainer_10wnq_1",He="_status_10wnq_6",Xe="_heading_10wnq_12",j={headerContainer:Ke,status:He,heading:Xe},Ze=u.lazy(async()=>_(()=>import("./index-ChkERRMK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Je=u.lazy(async()=>_(()=>import("./index-ByjDWLMw.js"),__vite__mapDeps([14,15,1,2,16,12,17,18,19,20,21,22,5,6,7,23,24,25,26,27,28,29,30,31,32,33,34,35,36])).then(e=>({default:e.RunInstanceScriptForm}))),et=u.lazy(async()=>_(()=>import("./index-BGtsiugz.js"),__vite__mapDeps([37,1,2,5,6,7,38,16,39,28,40,41]))),tt=u.lazy(async()=>_(()=>import("./index-gu1vgeKN.js"),__vite__mapDeps([42,1,2,43,44,45,38,16,39,46,47,12,21,48,17,18,49,50]))),st=({instance:e})=>{const{isFeatureEnabled:n}=we(),m=Ce(),h=Fe(),{notify:d}=ke(),{setSidePanelContent:r}=Ae(),{openActivityDetails:b}=Re(),{employee:v,isGettingEmployee:z}=Ge({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:B,isRestartingInstances:S}=Me(),{getAccessGroupQuery:$}=$e(),{sanitizeInstance:V,isSanitizingInstance:w}=ze(),{shutDownInstances:q,isShuttingDownInstances:C}=De(),{disassociateEmployeeFromInstance:N,isDisassociating:F}=Ne(),{value:G,setTrue:U,setFalse:Q}=p(),{value:W,setTrue:Y,setFalse:K}=p(),{value:H,setTrue:X,setFalse:Z}=p(),{value:J,setTrue:ee,setFalse:te}=p(),{value:se,setTrue:ae,setFalse:oe}=p(),{value:ie,setTrue:le,setFalse:k}=p(),{value:ne,setTrue:re,setFalse:A}=p(),{data:R,isPending:ce}=$(),i=Pe({initialValues:We,validationSchema:Ye,onSubmit:async a=>{if(!a.action)return;const D={computer_ids:[e.id],deliver_after:a.deliverImmediately?void 0:`${a.deliver_after}:00Z`};try{const{data:I}=a.action==="reboot"?await B(D):await q(D),P=a.action==="reboot"?"restarted":"shut down";d.success({title:`You queued "${e.title}" to be ${P}`,message:`Instance "${e.title}" will be ${P} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{b(I)}}]})}catch(I){m(I)}}});if(ce||z)return t.jsx(y,{});const de=async()=>{try{const{data:a}=await V({computer_id:e.id,computer_title:e.title});d.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{b(a)}}]})}catch(a){m(a)}finally{k()}},ue=()=>{r("Edit instance",t.jsx(u.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(Ze,{instance:e})}))},me=()=>{r("Run script",t.jsx(u.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(Je,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},pe=()=>{r(`Associate employee with ${e.title}`,t.jsx(u.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(et,{instanceTitle:e.title})}))},he=()=>{r(`Active profiles associated with ${e.title}`,t.jsx(u.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(tt,{instance:e})}),"medium")},ye=async()=>{try{await N({computer_id:e.id,employee_id:e.employee_id??0}),A(),d.success({title:`You have successfully disassociated ${v?.name??"the employee"}.`,message:`${v?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(a){m(a)}},x=async a=>{await i.setFieldValue("action",a),i.handleSubmit()},M=()=>{h(c.instances.root(),{replace:!0})},fe=R?R.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Te,{title:t.jsxs("div",{className:j.headerContainer,children:[t.jsx("h2",{className:Ee("p-heading--4 u-no-padding--top",j.heading),children:e.title}),e.is_wsl_instance&&t.jsx(Oe,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:ue},{icon:"restart",label:"Restart",onClick:U,excluded:!l(e).power},{icon:"power-off",label:"Shut down",onClick:Y,excluded:!l(e).power},{icon:"code",label:"Run script",onClick:me,excluded:!l(e).scripts},{icon:o.ICONS.user,label:"Associate employee",onClick:pe,collapsed:!0,excluded:!n("employee-management")||!l(e).employees||e.employee_id!==null},{icon:o.ICONS.user,label:"Disassociate employee",onClick:re,collapsed:!0,excluded:!n("employee-management")||!l(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:X,collapsed:!0,excluded:!l(e).uninstallation},{icon:"close",label:"Uninstall",onClick:ee,collapsed:!0,excluded:!l(e).uninstallation},{icon:o.ICONS.delete,label:"Remove from Landscape",onClick:ae,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:le,collapsed:!0,excluded:!l(e).sanitization}]}},e.employee_id??"no-employee"),t.jsxs(g,{children:[t.jsx(g.Item,{title:"Status",children:t.jsxs(s,{children:[t.jsx(s.Item,{label:"Status",value:t.jsxs("div",{className:j.status,children:[t.jsx(o.Icon,{name:T(e).icon??""}),t.jsx("span",{children:T(e).label})]})}),t.jsx(s.Item,{label:"Last ping time",value:f(e.last_ping_time).isValid()?f(e.last_ping_time).format(E):null}),t.jsx(s.Item,{label:"Access group",value:fe.find(a=>a.name===e.access_group)?.title||e.access_group}),t.jsx(s.Item,{label:"Tags",value:e.tags.join(", "),type:"truncated"}),t.jsx(s.Item,{label:"Profiles",value:e.profiles?.length?e.profiles.length===1?t.jsx(Qe,{profile:e.profiles[0]}):t.jsxs(o.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:he,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),l(e).employees&&t.jsx(s.Item,{label:"Associated employee",value:v?.name})]})}),t.jsx(g.Item,{title:"Registration details",children:t.jsxs(s,{children:[t.jsx(s.Item,{label:"Hostname",value:e.hostname}),t.jsx(s.Item,{label:"ID",value:e.id}),l(e).hardware&&t.jsx(s.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),l(e).hardware&&t.jsx(s.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(s.Item,{label:"OS",value:e.distribution_info?.description}),l(e).hardware&&t.jsx(s.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(a=>a.ip).join(", "):null,type:"truncated"}),t.jsx(s.Item,{label:"Registered",value:f(e.registered_at).format(E)})]})}),t.jsx(g.Item,{title:"Other",children:t.jsxs(s,{children:[t.jsx(s.Item,{label:"Annotations",value:null}),t.jsx(s.Item,{label:"Comment",value:e.comment})]})})]}),G&&t.jsx(o.ConfirmationModal,{close:Q,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:async()=>x("reboot"),children:t.jsxs(o.Form,{onSubmit:async()=>x("reboot"),noValidate:!0,children:[t.jsx(o.CheckboxInput,{label:"Deliver as soon as possible",...i.getFieldProps("deliverImmediately"),checked:i.values.deliverImmediately}),t.jsx(o.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...i.getFieldProps("deliver_after"),disabled:i.values.deliverImmediately,error:L(i,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),W&&t.jsx(o.ConfirmationModal,{close:K,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:C,confirmButtonLoading:C,onConfirm:async()=>x("shutdown"),children:t.jsxs(o.Form,{onSubmit:async()=>x("shutdown"),noValidate:!0,children:[t.jsx(o.CheckboxInput,{label:"Deliver as soon as possible",...i.getFieldProps("deliverImmediately"),checked:i.values.deliverImmediately}),t.jsx(o.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...i.getFieldProps("deliver_after"),disabled:i.values.deliverImmediately,error:L(i,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),ne&&t.jsx(o.ConfirmationModal,{close:A,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:ye,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",v?.name,". This will revoke their access to the instanceâ€™s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Ve,{close:Z,instances:[{name:e.title,computer_id:e.id}],isOpen:H,windowsInstance:e}),t.jsx(qe,{close:te,instances:[{name:e.title,computer_id:e.id}],isOpen:J,onSuccess:M,parentId:e.parent.id})]}),t.jsx(Be,{close:oe,instance:e,isOpen:se,onSuccess:M}),t.jsx(Le,{isOpen:ie,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:w,confirmButtonLoading:w,onConfirm:de,close:k,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},ut=Object.freeze(Object.defineProperty({__proto__:null,default:st},Symbol.toStringTag,{value:"Module"}));export{Qe as P,ut as i};
