const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-i9y1XxRf.js","assets/index-BcwS0-pu.js","assets/index-BJ2QPnO2.css","assets/MultiSelectField-WE4hQb-T.js","assets/MultiSelectField-CD3NDVCz.css","assets/SidePanelFormButtons-Ca5om5Ec.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/TagsAddConfirmationModal-BhvjIbHO.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/useGetTags-QEFIjI6m.js","assets/useRoles-BiygbnTO.js","assets/AssociationBlock-vsPH8fvb.css","assets/index-DCibdVbW.js","assets/ScriptsTabs-BX7SfrLP.js","assets/TruncatedCell-Dg2xqnA2.js","assets/TruncatedCell-DraJKZqh.css","assets/HeaderWithSearch-8u7NpAYq.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CerTJhlW.js","assets/useExpandableRow-BJRenp9X.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-Dwo2z67I.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-CS8OvFQf.js","assets/downshift.esm-B0nFPZy8.js","assets/ScriptDropdown-DwZ4WXvX.css","assets/index--jJ2cbZH.js","assets/CodeEditor-CpL3Lg9e.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-OYf-JdO7.js","assets/AttachmentFile-BYua8NOQ.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-ouSC0qlu.js","assets/AutoinstallFileVersionHistory-DtsIcRea.js","assets/SidePanelTablePagination-eQZVKu8b.js","assets/AutoinstallFileVersionHistory-BUeZdID_.css","assets/EmployeeList-C4MFweU8.js","assets/EmployeeList-DRxY5zMq.css","assets/useGetEmployees-DGIRWbYx.js","assets/index-DiU0noXl.css"])))=>i.map(i=>d[i]);
import{i as b,j as t,o as C,d as n,aL as fe,b as Y,e as ve,f as _e,g as xe,a as H,G as Ie,au as je,H as we,J as Ce,B as S,p as Se,X as Re,q as Fe,n as Ae,a5 as Ee,aM as Me,aN as ke,P as _,s as De,w as E,aE as d,I as l,aO as U,D as Q,t as W,O as Be,_ as $}from"./index-BcwS0-pu.js";import{B as M}from"./Blocks-Cn6mBR9S.js";import{C as Te}from"./AutoinstallFileVersionHistory-DtsIcRea.js";import"./index-CerTJhlW.js";import"./EmployeeList-C4MFweU8.js";import{u as Le,I as Oe}from"./InstanceRemoveFromLandscapeModal-cgPLScA7.js";import{u as $e}from"./useRoles-BiygbnTO.js";import{h as ze,i as Ne}from"./WslInstancesEmptyState-04PgSYyJ.js";import"./SidePanelTablePagination-eQZVKu8b.js";import"./TruncatedCell-Dg2xqnA2.js";import"./useRemoveInstancesFromLandscape-XS6thuI-.js";import"./GroupFilter-BgiXf2z0.js";import"./HeaderWithSearch-8u7NpAYq.js";import"./useExpandableRow-BJRenp9X.js";const Pe="_container_dj78y_1",Ve="_wrapped_dj78y_8",qe="_innerContainer_dj78y_13",Ge="_button_dj78y_17",Ue="_titleRow_dj78y_21",j={container:Pe,wrapped:Ve,innerContainer:qe,button:Ge,titleRow:Ue},Qe=({actions:{destructive:e=[],nondestructive:s=[]},title:i})=>{e=e.filter(a=>!a.excluded),s=s.filter(a=>!a.excluded);const h=[...s,...e],u={nondestructive:[],destructive:[]},[r,v]=b.useState(h),[f,R]=b.useState(u),[k,w]=b.useState(!1),[D,B]=b.useState(0),x=s.filter(a=>a.collapsed).length+e.filter(a=>a.collapsed).length>1,T=(a,y)=>{if(f.destructive.length||f.nondestructive.length)return;if((!a.lastElementChild||a.lastElementChild.getBoundingClientRect().right<=y.getBoundingClientRect().right)&&!x){w(!1);return}w(!0);const g=[],m={nondestructive:[],destructive:[]};s.forEach((p,I)=>{a.children[I].getBoundingClientRect().right>a.getBoundingClientRect().right||p.collapsed&&x?m.nondestructive.push(p):g.push(p)}),e.forEach((p,I)=>{I+=s.length,a.children[I].getBoundingClientRect().right>a.getBoundingClientRect().right||p.collapsed&&x?m.destructive.push(p):g.push(p)}),v(g),R(m)},F=a=>{const y=a?.parentElement?.parentElement;if(!y)return;T(a,y);const g=new ResizeObserver(()=>{const{width:m}=y.getBoundingClientRect();m!==D&&(v(h),R(u),B(m))});return g.observe(y),()=>{g.disconnect()}};return t.jsxs("div",{className:C(j.titleRow,{[j.wrapped]:!r.length}),children:[i,t.jsxs("div",{className:C(j.container,{[j.wrapped]:!r.length}),children:[t.jsx("div",{className:C(j.innerContainer,"p-segmented-control"),children:t.jsx("div",{ref:F,className:"p-segmented-control__list",children:r.map(({collapsed:a,excluded:y,icon:g,label:m,...p})=>t.jsxs(n.Button,{className:C(j.button,"u-no-margin--bottom p-segmented-control__button"),...p,children:[t.jsx(n.Icon,{name:g}),t.jsx("span",{children:m})]},m))})}),k&&t.jsx(fe,{hasToggleIcon:!0,toggleLabel:r.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...e,...s].every(a=>a.disabled),actions:f.nondestructive,destructiveActions:f.destructive})]})]})},We=()=>{const e=Y(),s=ve(),{mutateAsync:i,isPending:h}=_e({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:u,computer_id:r})=>e.delete(`employees/${u}/computers/${r}`),onSuccess:(u,r)=>{s.invalidateQueries({queryKey:["instances",r.computer_id]})}});return{disassociateEmployeeFromInstance:i,isDisassociating:h}},Ye=(e,s={})=>{const i=Y(),{id:h,...u}=e,{data:r,isLoading:v}=xe({queryKey:["employees","employee",e],queryFn:async()=>i.get(`employees/${h}`,{params:u}),...s});return{employee:r?.data,isGettingEmployee:v}},He=({profiles:e})=>{const{isFeatureEnabled:s}=H();return s("script-profiles")||(e=e.filter(i=>i.type!=="script")),s("usg-profiles")||(e=e.filter(i=>i.type!=="security")),s("wsl-child-instance-profiles")||(e=e.filter(i=>i.type!=="wsl")),e.map((i,h)=>t.jsxs("span",{children:[i.title,h<e.length-1?", ":""]},`${i.type}${i.id}`))},Ke={deliver_after:"",deliverImmediately:!0,action:null},Je=Ie().shape({deliver_after:Ce().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:s=>S(s).isValid()}).test({message:"Date must be in the future",test:s=>S(s).isAfter()})}),deliverImmediately:we(),action:je().oneOf(["shutdown","reboot"]).required()}),Xe="_headerContainer_10wnq_1",Ze="_status_10wnq_6",et="_heading_10wnq_12",O={headerContainer:Xe,status:Ze,heading:et},tt=b.lazy(async()=>$(()=>import("./index-i9y1XxRf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),st=b.lazy(async()=>$(()=>import("./index-DCibdVbW.js"),__vite__mapDeps([13,14,1,2,15,16,11,17,18,19,20,21,22,23,5,6,7,24,25,26,27,28,29,30,31,32,33,34,35])).then(e=>({default:e.RunInstanceScriptForm}))),at=b.lazy(async()=>$(()=>import("./index-ouSC0qlu.js"),__vite__mapDeps([36,1,2,5,6,7,21,37,38,39,40,15,16,41,27,42,43]))),vt=({instance:e})=>{const{isFeatureEnabled:s}=H(),i=Se(),h=Re(),{notify:u}=Fe(),{setSidePanelContent:r}=Ae(),{openActivityDetails:v}=Ee(),{employee:f,isGettingEmployee:R}=Ye({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:k,isRestartingInstances:w}=Me(),{getAccessGroupQuery:D}=$e(),{sanitizeInstance:B,isSanitizingInstance:x}=Le(),{shutDownInstances:T,isShuttingDownInstances:F}=ke(),{disassociateEmployeeFromInstance:a,isDisassociating:y}=We(),{value:g,setTrue:m,setFalse:p}=_(),{value:I,setTrue:K,setFalse:J}=_(),{value:X,setTrue:Z,setFalse:ee}=_(),{value:te,setTrue:se,setFalse:ae}=_(),{value:ie,setTrue:le,setFalse:oe}=_(),{value:ne,setTrue:re,setFalse:z}=_(),{value:ce,setTrue:de,setFalse:N}=_(),{data:P,isPending:ue}=D(),c=De({initialValues:Ke,validationSchema:Je,onSubmit:async o=>{if(!o.action)return;const q={computer_ids:[e.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:L}=o.action==="reboot"?await k(q):await T(q),G=o.action==="reboot"?"restarted":"shut down";u.success({title:`You queued "${e.title}" to be ${G}`,message:`Instance "${e.title}" will be ${G} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{v(L)}}]})}catch(L){i(L)}}});if(ue||R)return t.jsx(E,{});const me=async()=>{try{const{data:o}=await B({computer_id:e.id,computer_title:e.title});u.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{v(o)}}]})}catch(o){i(o)}finally{z()}},pe=()=>{r("Edit instance",t.jsx(b.Suspense,{fallback:t.jsx(E,{}),children:t.jsx(tt,{instance:e})}))},he=()=>{r("Run script",t.jsx(b.Suspense,{fallback:t.jsx(E,{}),children:t.jsx(st,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},ye=()=>{r(`Associate employee with ${e.title}`,t.jsx(b.Suspense,{fallback:t.jsx(E,{}),children:t.jsx(at,{instanceTitle:e.title})}))},ge=async()=>{try{await a({computer_id:e.id,employee_id:e.employee_id??0}),N(),u.success({title:`You have successfully disassociated ${f?.name??"the employee"}.`,message:`${f?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(o){i(o)}},A=async o=>{await c.setFieldValue("action",o),c.handleSubmit()},V=()=>{h("/instances",{replace:!0})},be=P?P.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Qe,{title:t.jsxs("div",{className:O.headerContainer,children:[t.jsx("h2",{className:C("p-heading--4 u-no-padding--top",O.heading),children:e.title}),e.is_wsl_instance&&t.jsx(Te,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:pe},{icon:"restart",label:"Restart",onClick:m,excluded:!d(e).power},{icon:"power-off",label:"Shut down",onClick:K,excluded:!d(e).power},{icon:"code",label:"Run script",onClick:he,excluded:!d(e).scripts},{icon:n.ICONS.user,label:"Associate employee",onClick:ye,collapsed:!0,excluded:!s("employee-management")||!d(e).employees||e.employee_id!==null},{icon:n.ICONS.user,label:"Disassociate employee",onClick:de,collapsed:!0,excluded:!s("employee-management")||!d(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:Z,collapsed:!0,excluded:!d(e).uninstallation},{icon:"close",label:"Uninstall",onClick:se,collapsed:!0,excluded:!d(e).uninstallation},{icon:n.ICONS.delete,label:"Remove from Landscape",onClick:le,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:re,collapsed:!0,excluded:!d(e).sanitization}]}},e.employee_id??"no-employee"),t.jsxs(M,{children:[t.jsx(M.Item,{title:"Status",children:t.jsxs(l,{children:[t.jsx(l.Item,{label:"Status",value:t.jsxs("div",{className:O.status,children:[t.jsx(n.Icon,{name:U(e).icon??""}),t.jsx("span",{children:U(e).label})]})}),t.jsx(l.Item,{label:"Last ping time",value:S(e.last_ping_time).isValid()?S(e.last_ping_time).format(Q):null}),t.jsx(l.Item,{label:"Access group",value:be.find(o=>o.name===e.access_group)?.title||e.access_group}),t.jsx(l.Item,{label:"Tags",value:e.tags.join(", ")||null,type:"truncated"}),t.jsx(l.Item,{label:"Profiles",value:e.profiles?.length?t.jsx(He,{profiles:e.profiles}):null,type:"truncated"}),d(e).employees&&t.jsx(l.Item,{label:"Associated employee",value:f?.name})]})}),t.jsx(M.Item,{title:"Registration details",children:t.jsxs(l,{children:[t.jsx(l.Item,{label:"Hostname",value:e.hostname}),t.jsx(l.Item,{label:"ID",value:e.id}),d(e).hardware&&t.jsx(l.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),d(e).hardware&&t.jsx(l.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(l.Item,{label:"OS",value:e.distribution_info?.description}),d(e).hardware&&t.jsx(l.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(o=>o.ip).join(", "):null,type:"truncated"}),t.jsx(l.Item,{label:"Registered",value:S(e.registered_at).format(Q)})]})}),t.jsx(M.Item,{title:"Other",children:t.jsxs(l,{children:[t.jsx(l.Item,{label:"Annotations",value:null}),t.jsx(l.Item,{label:"Comment",value:e.comment||null})]})})]}),g&&t.jsx(n.ConfirmationModal,{close:p,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:w,confirmButtonLoading:w,onConfirm:async()=>A("reboot"),children:t.jsxs(n.Form,{onSubmit:async()=>A("reboot"),noValidate:!0,children:[t.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),t.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:W(c,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),I&&t.jsx(n.ConfirmationModal,{close:J,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:async()=>A("shutdown"),children:t.jsxs(n.Form,{onSubmit:async()=>A("shutdown"),noValidate:!0,children:[t.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),t.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:W(c,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),ce&&t.jsx(n.ConfirmationModal,{close:N,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:ge,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",f?.name,". This will revoke their access to the instanceâ€™s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(ze,{close:ee,instances:[{name:e.title,computer_id:e.id}],isOpen:X,windowsInstance:e}),t.jsx(Ne,{close:ae,instances:[{name:e.title,computer_id:e.id}],isOpen:te,onSuccess:V,parentId:e.parent.id})]}),t.jsx(Oe,{close:oe,instance:e,isOpen:ie,onSuccess:V}),t.jsx(Be,{isOpen:ne,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:me,close:z,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})};export{vt as default};
