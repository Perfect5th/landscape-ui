const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-COk0bOSo.js","assets/index-CltrzfEM.js","assets/index-BJ2QPnO2.css","assets/HeaderWithSearch-dyLsZe2w.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/CellInput-CJ4Q2V6T.js","assets/SidePanelTablePagination-DseJ8Vfs.js","assets/PageMain-B5CGrEAv.js","assets/PageMain-CIunaku7.css","assets/useRoles-CrC1PwPd.js","assets/TruncatedCell-kvpjmjVw.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-B3rwWmH5.js","assets/index-DkxMn-0U.css","assets/index-CCYFAcAi.js","assets/AssociationBlock-DX8_A7xh.js","assets/MultiSelectField-BkCPMoWo.js","assets/MultiSelectField-CD3NDVCz.css","assets/useGetTags-BxwF3Kxd.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-D9kT0cNJ.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/index-D2oHr3K6.js","assets/index-CoaroevR.js","assets/FileInput-BFVx_0Lm.js","assets/useGetInstances-DfYmF7Iz.js","assets/PackageProfileConstraintsBlock-DuBWxtEY.js","assets/PackageProfileConstraintsBlock-CdyFUl7u.css","assets/index-CLnfUnnC.css"])))=>i.map(i=>d[i]);
import{e as B,b as z,c as K,f as v,g as I,G as O,a9 as G,J as y,R,K as U,H as N,au as W,j as e,aC as $,a6 as J,v as C,i as l,w as P,d,n as _,_ as b,p as w,q as L,I as j,O as F,P as Y,av as X,h as Z,aI as ee,al as ae,aJ as se,aw as te,a0 as ne,E as oe}from"./index-CltrzfEM.js";import{P as ie,a as re,b as ce}from"./PageMain-B5CGrEAv.js";import{u as q}from"./useRoles-CrC1PwPd.js";import{H as D}from"./HeaderWithSearch-dyLsZe2w.js";import{S as le}from"./SidePanelTablePagination-DseJ8Vfs.js";import{T as de}from"./TruncatedCell-kvpjmjVw.js";import{u as ue}from"./useExpandableRow-B3rwWmH5.js";function T(){const a=B(),s=z(),i=K(),n=(o={},c={})=>I({queryKey:["packageProfiles",o],queryFn:async()=>s.get("packageprofiles",{params:o}),...c}),u=v({mutationFn:async o=>s.post("packageprofiles",o),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),r=v({mutationFn:async o=>s.post("packageprofiles",o),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),p=v({mutationFn:async o=>i.get("RemovePackageProfile",{params:o}),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),h=v({mutationFn:async({name:o,...c})=>s.put(`packageprofiles/${o}`,c),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),f=({instanceId:o,...c},x={})=>I({queryKey:["instancePackageProfiles",{instanceId:o,...c}],queryFn:async()=>s.get(`computers/${o}/packages/profile`,{params:c}),...x}),g=({name:o,...c},x={})=>I({queryKey:["packageProfileConstraints",{name:o,...c}],queryFn:async()=>s.get(`packageprofiles/${o}/constraints`,{params:c}),...x}),m=v({mutationFn:async({name:o,...c})=>s.post(`packageprofiles/${o}/constraints`,c),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),k=v({mutationFn:async({id:o,name:c,...x})=>s.put(`packageprofiles/${c}/constraints/${o}`,x),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),t=v({mutationFn:async({name:o,...c})=>s.delete(`packageprofiles/${o}/constraints`,{params:c}),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:m,copyPackageProfileQuery:u,createPackageProfileQuery:r,editPackageProfileConstraintQuery:k,editPackageProfileQuery:h,getInstancePackageProfileQuery:f,getPackageProfileConstraintsQuery:g,getPackageProfilesQuery:n,removePackageProfileConstraintsQuery:t,removePackageProfileQuery:p}}const Q={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Ye=Object.fromEntries(Object.keys(Q).map(a=>[a,!0])),pe={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},ge=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],me=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],Xe={access_group:G,all_computers:!1,constraints:[Q],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Ze=O().shape({access_group:y(),all_computers:N(),constraints:R().when("constraintsType",{is:"manual",then:a=>a.of(O().shape({constraint:y().required("Required."),notAnyVersion:N(),package:y().required("Required."),rule:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:y().required("This field is required."),csvFile:W().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:y().required("This field is required."),isCsvFileParsed:N(),material:y().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:U().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:R().of(y()),title:y().required("This field is required.")}),M=({packageProfile:a})=>!a.tags.length&&!a.all_computers?e.jsx($,{}):a.computers.constrained.length?e.jsxs(J,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:package:${a.id}`)}`},children:[a.computers.constrained.length," ",C(a.computers.constrained.length,"instance")]}):"0 instances",Pe="_constraint_1lz67_1",he="_hidden_1lz67_5",V={constraint:Pe,hidden:he},fe=({row:a,column:s})=>{const i={};return a.original.package==="loading"?s.id==="package"?i.colSpan=3:(i.className=V.hidden,i["aria-hidden"]=!0):s.id==="package"?i.role="rowheader":s.id==="constraint"?i["aria-label"]="Constraint":s.id==="rule"?i["aria-label"]="Rule":s.id==="version"&&(i["aria-label"]="Version"),i},ye=({isConstraintsLoading:a,profileConstraints:s,search:i})=>{const n=l.useMemo(()=>a?[pe]:s?s.map(r=>({...r,notAnyVersion:!!r.version})):[],[a,s]),u=l.useMemo(()=>[{accessor:"constraint",className:V.constraint,Header:"Constraint",Cell:({row:{original:r}})=>me.find(({value:p})=>p===r.constraint)?.label??r.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:r}})=>r.package==="loading"?e.jsx(P,{}):r.package},{accessor:"version",Header:"Version",Cell:({row:{original:r}})=>r.version?`${ge.find(({value:p})=>p===r.rule)?.label} ${r.version}`:"Any"}],[n]);return e.jsx(d.ModularTable,{columns:u,data:n,getCellProps:fe,emptyMsg:`No constraints found with the search: "${i}"`})},ke="_actions_nxngq_1",xe={actions:ke},je=l.lazy(()=>b(()=>import("./index-COk0bOSo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),be=({profile:a})=>{const[s,i]=l.useState(1),[n,u]=l.useState(20),[r,p]=l.useState(""),{setSidePanelContent:h}=_(),{getPackageProfileConstraintsQuery:f}=T(),{data:g,isLoading:m}=f({name:a.name,limit:n,offset:(s-1)*n,search:r}),k=()=>{h(`Change "${a.title}" profile's constraints`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(je,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!r&&s===1&&n===20&&m&&e.jsx(P,{}),(r||s!==1||n!==20||!m&&g&&g.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:xe.actions,onSearch:t=>p(t),actions:e.jsx(d.Button,{className:"u-no-margin--bottom",type:"button",onClick:k,children:"Change package constraints"})}),e.jsx(ye,{isConstraintsLoading:m,profileConstraints:g?.data.results,search:r}),e.jsx(le,{currentPage:s,pageSize:n,paginate:t=>i(t),setPageSize:t=>u(t),totalItems:g?.data.count})]})]})},ve=l.lazy(async()=>b(()=>import("./index-CCYFAcAi.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20,21,22,9,7,8,3,4,6,10,11,12]))),_e=l.lazy(async()=>b(()=>import("./index-D2oHr3K6.js"),__vite__mapDeps([23,1,2,20,21,22,15,16,17,18,19,7,8,9,3,4,6,10,11,12]))),Ce=({profile:a})=>{const[s,i]=l.useState(!1),n=w(),{notify:u}=L(),{closeSidePanel:r,setSidePanelContent:p}=_(),{removePackageProfileQuery:h}=T(),{getAccessGroupQuery:f}=q(),{data:g}=f(),m=g?.data??[],{mutateAsync:k,isPending:t}=h,o=()=>{i(!0)},c=()=>{i(!1)},x=async()=>{try{await k({name:a.name}),c(),r(),u.success({message:`Package profile "${a.name}" removed successfully.`,title:"Package profile removed"})}catch(A){c(),n(A)}},S=()=>{p("Edit package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(_e,{profile:a})}))},H=()=>{p("Duplicate package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ve,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(d.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:H,children:[e.jsx(d.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(d.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:S,children:[e.jsx(d.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(d.Button,{className:"p-segmented-control__button u-no-margin",hasIcon:!0,type:"button",onClick:o,"aria-label":`Remove ${a.title} package profile`,children:[e.jsx(d.Icon,{name:d.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(j,{spaced:!0,children:[e.jsx(j.Item,{label:"Title",value:a.title}),e.jsx(j.Item,{label:"Name",value:a.name}),e.jsx(j.Item,{label:"Description",value:a.description}),e.jsx(j.Item,{label:"Access group",value:m.find(A=>A.name===a.access_group)?.title??a.access_group}),e.jsx(j.Item,{label:"Tags",large:!0,value:a.tags.join(", ")||null,type:"truncated"}),e.jsx(j.Item,{label:"Associated to",value:e.jsx(M,{packageProfile:a})}),e.jsx(j.Item,{label:"Pending on",value:`${a.computers.pending?.length??0} ${C(a.computers.pending.length,"instance")}`}),e.jsx(j.Item,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} ${C(a.computers["non-compliant"].length,"instance")}`})]}),e.jsx(be,{profile:a}),e.jsx(F,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:t,confirmButtonDisabled:t,close:c,confirmationText:`remove ${a.title}`,onConfirm:x,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Te=l.lazy(async()=>b(()=>import("./index-COk0bOSo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Se=l.lazy(async()=>b(()=>import("./index-CCYFAcAi.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20,21,22,9,7,8,3,4,6,10,11,12]))),Ae=l.lazy(async()=>b(()=>import("./index-D2oHr3K6.js"),__vite__mapDeps([23,1,2,20,21,22,15,16,17,18,19,7,8,9,3,4,6,10,11,12]))),Ie=({profile:a})=>{const s=w(),{notify:i}=L(),{setSidePanelContent:n}=_(),{removePackageProfileQuery:u}=T(),{value:r,setTrue:p,setFalse:h}=Y(),{mutateAsync:f,isPending:g}=u,m=()=>{n(`Change "${a.title}" profile's constraints`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Te,{profile:a})}),"medium")},k=()=>{n(`Edit "${a.title}" profile`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ae,{profile:a})}))},t=()=>{n(`Duplicate "${a.title}" profile`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Se,{profile:a})}))},o=async()=>{try{await f({name:a.name}),i.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(S){s(S)}finally{h()}},c=[{icon:"edit",label:"Edit","aria-label":`Edit ${a.title} profile`,onClick:k},{icon:"applications",label:"Change package constraints","aria-label":`Change ${a.title} package constraints`,onClick:m},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${a.title} profile`,onClick:t}],x=[{icon:"delete",label:"Remove","aria-label":`Remove ${a.title} profile`,onClick:p}];return e.jsxs(e.Fragment,{children:[e.jsx(X,{toggleAriaLabel:`${a.title} profile actions`,actions:c,destructiveActions:x}),e.jsx(F,{isOpen:r,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:g,confirmButtonDisabled:g,close:h,confirmationText:`remove ${a.title}`,onConfirm:o,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Ne=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,Ee=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,Oe=a=>({column:s,row:{index:i}})=>{const n={};switch(s.id){case"title":n.role="rowheader";break;case"description":n["aria-label"]="Description";break;case"access_group":n["aria-label"]="Access group";break;case"tags":n["aria-label"]="Tags",a===i&&(n.className="expandedCell");break;case"computers['non-compliant']":n["aria-label"]="Not compliant instances";break;case"computers['pending']":n["aria-label"]="Pending instances";break;case"computers['constrained']":n["aria-label"]="Associated instances";break;case"actions":n["aria-label"]="Actions";break}return n},Re=a=>({index:s,original:i})=>{const n={};return a===s&&(n.className="expandedRow"),n["aria-label"]=`${i.title} package profile row`,n},$e="_description_y3fly_1",we="_noWrap_y3fly_2",E={description:$e,noWrap:we},Le=({packageProfiles:a})=>{const{search:s}=Z(),{setSidePanelContent:i}=_(),{getAccessGroupQuery:n}=q(),{expandedRowIndex:u,handleExpand:r,getTableRowsRef:p}=ue(),{data:h}=n(),f=h?.data.map(({name:t,title:o})=>({label:o,value:t}))??[],g=t=>{i(t.title,e.jsx(Ce,{profile:t}),"medium")},m=l.useMemo(()=>s?a.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),k=l.useMemo(()=>[{...ee,Cell:({row:{original:t}})=>e.jsxs(se,{children:[e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{g(t)},children:t.title}),e.jsx("span",{className:"u-text--muted",children:t.name})]})},{accessor:"description",className:E.description,Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:t}}})=>f.find(({value:o})=>o===t)?.label??t},{accessor:"tags",Header:"Tags",Cell:({row:{original:{tags:t},index:o}})=>t.length>0?e.jsx(de,{content:t.map(c=>e.jsx("span",{className:"truncatedItem",children:c},c)),isExpanded:o==u,onExpand:()=>{r(o)},showCount:!0}):e.jsx($,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:E.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(d.Tooltip,{position:"btm-left",message:Ne,children:e.jsx(d.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers["non-compliant"].length} ${C(t.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:E.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(d.Tooltip,{position:"btm-left",message:Ee,children:e.jsx(d.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers.pending?.length??0} ${C(t.computers.pending.length,"instance")}`})},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:t}})=>e.jsx(M,{packageProfile:t})},{...ae,Cell:({row:{original:t}})=>e.jsx(Ie,{profile:t})}],[f.length,u]);return e.jsx("div",{ref:p,children:e.jsx(te,{columns:k,data:m,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:Oe(u),getRowProps:Re(u),minWidth:1200})})},Fe=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(ne,{filtersToDisplay:["search"]})]}),qe=l.lazy(()=>b(()=>import("./index-CoaroevR.js").then(a=>a.i),__vite__mapDeps([24,1,2,15,16,17,18,19,20,21,22,9,25,26,27,5,28,29]))),De=()=>{const{setSidePanelContent:a}=_(),s=()=>{a("Add package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(qe,{})}),"medium")};return e.jsx(oe,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any package profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(d.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},Qe=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsx(Le,{packageProfiles:a})]}),Me=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:i}=a();return e.jsxs(e.Fragment,{children:[i&&e.jsx(P,{}),!i&&(!s||s.data.result.length===0)&&e.jsx(De,{}),!i&&s&&s.data.result.length>0&&e.jsx(Qe,{packageProfiles:s?.data.result})]})},Ve=l.lazy(()=>b(()=>import("./index-CoaroevR.js").then(a=>a.a),__vite__mapDeps([24,1,2,15,16,17,18,19,20,21,22,9,25,26,27,5,28,29])).then(a=>({default:a.PackageProfileCreateForm}))),He=()=>{const{setSidePanelContent:a}=_(),s=()=>{a("Add package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ve,{})}),"medium")};return e.jsxs(ie,{children:[e.jsx(re,{title:"Package profiles",actions:[e.jsx(d.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(ce,{children:e.jsx(Me,{})})]})},ea=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{me as C,Q as E,Xe as I,pe as L,Le as P,Ye as T,Ze as V,ge as a,Fe as b,De as c,ea as i,T as u};
