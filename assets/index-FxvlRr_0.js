const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CpBGZ7Sb.js","assets/index-CmSMPezD.js","assets/index-mAgDtnB8.css","assets/MultiSelectField-B3pDsC9j.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-CjUuXzzk.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/TagsAddConfirmationModal-z_TWllRV.js","assets/ModalTablePagination-B4EN9Q-h.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useGetTags-DJiNc4pX.js","assets/useRoles-BTw0Yb4r.js","assets/AssociationBlock-vsPH8fvb.css","assets/index-ChAyqhRJ.js","assets/ScriptsTabs-BkwsLcGM.js","assets/constants-Cb-1ccE2.js","assets/TextConfirmationModal-B_Arotg1.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/HeaderWithSearch-DlYciVG-.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-mOkivHGi.js","assets/ScriptsTabs-DN44MVZt.css","assets/useRunScript-E-dbm5gY.js","assets/DeliveryBlock-PDir6mkj.js","assets/RadioGroup-BEv35C8q.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-DAeXhp4_.js","assets/downshift.esm-CzgZJGGT.js","assets/ScriptDropdown-DGqiHs-J.css","assets/index-C3ra5W6o.js","assets/CodeEditor-BxMd2z1P.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-B39rJpK4.js","assets/AttachmentFile-Cyz2S3QP.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-RUjqNdgg.js","assets/EmployeeList-B2J248I4.js","assets/EmployeeList-CnpN88if.css","assets/useGetEmployees-il1_KHdB.js","assets/index-CzWO0kSt.css","assets/index-CDSl8vBa.js","assets/SidePanelTableFilterChips-CJJrkYHs.js","assets/SidePanelTablePagination-DgVi2UEo.js","assets/Chip-CTUH_lOG.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-CDWDIhLY.js","assets/useRemoveInstancesFromLandscape-rZ5xBqN0.js","assets/WslInstancesEmptyState-BFVGDpaK.js","assets/GroupFilter-Cqjaoau6.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{o as d,j as t,K as R,e as l,aO as ve,d as K,k as _e,l as xe,m as je,R as b,S as Ie,B as we,au as Se,C as Ce,f as Re,y as k,c as ke,t as Ae,Y as Fe,v as Ee,s as Me,I as Te,aP as De,aQ as Be,a3 as x,w as Le,a as C,aB as c,U as M,J as a,aL as Q,V as W,x as Y,a1 as T}from"./index-CmSMPezD.js";import{T as Pe}from"./TextConfirmationModal-B_Arotg1.js";import{C as Oe}from"./Chip-CTUH_lOG.js";import"./EmployeeList-B2J248I4.js";import{u as ze,I as Ve}from"./InstanceRemoveFromLandscapeModal-CDWDIhLY.js";import{u as $e}from"./useRoles-BTw0Yb4r.js";import"./index-mOkivHGi.js";import{W as Ne,a as qe}from"./WslInstancesEmptyState-BFVGDpaK.js";const Ge="_container_dj78y_1",Ue="_wrapped_dj78y_8",Qe="_innerContainer_dj78y_13",We="_button_dj78y_17",Ye="_titleRow_dj78y_21",w={container:Ge,wrapped:Ue,innerContainer:Qe,button:We,titleRow:Ye},Ke=({actions:{destructive:e=[],nondestructive:o=[]},title:y})=>{e=e.filter(s=>!s.excluded),o=o.filter(s=>!s.excluded);const v=[...o,...e],u={nondestructive:[],destructive:[]},[n,_]=d.useState(v),[f,A]=d.useState(u),[D,S]=d.useState(!1),[B,L]=d.useState(0),j=o.filter(s=>s.collapsed).length+e.filter(s=>s.collapsed).length>1,P=(s,h)=>{if(f.destructive.length||f.nondestructive.length)return;if((!s.lastElementChild||s.lastElementChild.getBoundingClientRect().right<=h.getBoundingClientRect().right)&&!j){S(!1);return}S(!0);const g=[],m={nondestructive:[],destructive:[]};o.forEach((p,I)=>{s.children[I].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&j?m.nondestructive.push(p):g.push(p)}),e.forEach((p,I)=>{I+=o.length,s.children[I].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&j?m.destructive.push(p):g.push(p)}),_(g),A(m)},F=s=>{const h=s?.parentElement?.parentElement;if(!h)return;P(s,h);const g=new ResizeObserver(()=>{const{width:m}=h.getBoundingClientRect();m!==B&&(_(v),A(u),L(m))});return g.observe(h),()=>{g.disconnect()}};return t.jsxs("div",{className:R(w.titleRow,{[w.wrapped]:!n.length}),children:[y,t.jsxs("div",{className:R(w.container,{[w.wrapped]:!n.length}),children:[t.jsx("div",{className:R(w.innerContainer,"p-segmented-control"),children:t.jsx("div",{ref:F,className:"p-segmented-control__list",children:n.map(({collapsed:s,excluded:h,icon:g,label:m,...p})=>t.jsxs(l.Button,{className:R(w.button,"u-no-margin--bottom p-segmented-control__button"),...p,children:[t.jsx(l.Icon,{name:g}),t.jsx("span",{children:m})]},m))})}),D&&t.jsx(ve,{hasToggleIcon:!0,toggleLabel:n.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...e,...o].every(s=>s.disabled),actions:f.nondestructive,destructiveActions:f.destructive})]})]})},He=()=>{const e=K(),o=_e(),{mutateAsync:y,isPending:v}=xe({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:u,computer_id:n})=>e.delete(`employees/${u}/computers/${n}`),onSuccess:(u,n)=>{o.invalidateQueries({queryKey:["instances",n.computer_id]})}});return{disassociateEmployeeFromInstance:y,isDisassociating:v}},Je=(e,o={})=>{const y=K(),{id:v,...u}=e,{data:n,isLoading:_}=je({queryKey:["employees","employee",e],queryFn:async()=>y.get(`employees/${v}`,{params:u}),...o});return{employee:n?.data,isGettingEmployee:_}},Ze=e=>{switch(e.type){case"package":return b.profiles.package({sidePath:["view"],profile:e.name||""});case"reboot":return b.profiles.reboot({sidePath:["view"],profile:e.id.toString()||""});case"removal":return b.profiles.removal({sidePath:["view"],profile:e.id.toString()||""});case"repository":return b.profiles.repository({search:e.title||""});case"script":return b.scripts.root({tab:"profiles",sidePath:["view"],profile:e.id.toString()||""});case"security":return b.profiles.security({sidePath:["view"],profile:e.id.toString()||""});case"upgrade":return b.profiles.upgrade({sidePath:["view"],profile:e.id.toString()||""});case"wsl":return b.profiles.wsl({sidePath:["view"],profile:e.name||""})}},Xe=({profile:e})=>t.jsx(Ie,{to:Ze(e),children:e.title}),et={deliver_after:"",deliverImmediately:!0,action:null},tt=we().shape({deliver_after:Re().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:o=>k(o).isValid()}).test({message:"Date must be in the future",test:o=>k(o).isAfter()})}),deliverImmediately:Ce(),action:Se().oneOf(["shutdown","reboot"]).required()}),st="_headerContainer_10wnq_1",ot="_status_10wnq_6",at="_heading_10wnq_12",z={headerContainer:st,status:ot,heading:at},it=d.lazy(async()=>T(()=>import("./index-CpBGZ7Sb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),lt=d.lazy(async()=>T(()=>import("./index-ChAyqhRJ.js"),__vite__mapDeps([14,15,1,2,16,12,17,18,19,20,21,22,23,24,5,6,7,25,26,27,28,29,30,31,32,33,34,35,36,37,38])).then(e=>({default:e.RunInstanceScriptForm}))),nt=d.lazy(async()=>T(()=>import("./index-RUjqNdgg.js"),__vite__mapDeps([39,1,2,5,6,7,40,16,41,30,42,43]))),rt=d.lazy(async()=>T(()=>import("./index-CDSl8vBa.js"),__vite__mapDeps([44,1,2,45,46,17,18,47,48,40,16,41,49,50,12,23,51,52,19,20,53,54]))),ct=({instance:e})=>{const{isFeatureEnabled:o}=ke(),y=Ae(),v=Fe(),{notify:u}=Ee(),{setSidePanelContent:n}=Me(),{openActivityDetails:_}=Te(),{employee:f,isGettingEmployee:A}=Je({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:D,isRestartingInstances:S}=De(),{getAccessGroupQuery:B}=$e(),{sanitizeInstance:L,isSanitizingInstance:j}=ze(),{shutDownInstances:P,isShuttingDownInstances:F}=Be(),{disassociateEmployeeFromInstance:s,isDisassociating:h}=He(),{value:g,setTrue:m,setFalse:p}=x(),{value:I,setTrue:H,setFalse:J}=x(),{value:Z,setTrue:X,setFalse:ee}=x(),{value:te,setTrue:se,setFalse:oe}=x(),{value:ae,setTrue:ie,setFalse:le}=x(),{value:ne,setTrue:re,setFalse:V}=x(),{value:ce,setTrue:de,setFalse:$}=x(),{data:N,isPending:ue}=B(),r=Le({initialValues:et,validationSchema:tt,onSubmit:async i=>{if(!i.action)return;const G={computer_ids:[e.id],deliver_after:i.deliverImmediately?void 0:`${i.deliver_after}:00Z`};try{const{data:O}=i.action==="reboot"?await D(G):await P(G),U=i.action==="reboot"?"restarted":"shut down";u.success({title:`You queued "${e.title}" to be ${U}`,message:`Instance "${e.title}" will be ${U} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{_(O)}}]})}catch(O){y(O)}}});if(ue||A)return t.jsx(C,{});const me=async()=>{try{const{data:i}=await L({computer_id:e.id,computer_title:e.title});u.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{_(i)}}]})}catch(i){y(i)}finally{V()}},pe=()=>{n("Edit instance",t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(it,{instance:e})}))},he=()=>{n("Run script",t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(lt,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},ge=()=>{n(`Associate employee with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(nt,{instanceTitle:e.title})}))},ye=()=>{n(`Active profiles associated with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(rt,{instance:e})}),"medium")},fe=async()=>{try{await s({computer_id:e.id,employee_id:e.employee_id??0}),$(),u.success({title:`You have successfully disassociated ${f?.name??"the employee"}.`,message:`${f?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(i){y(i)}},E=async i=>{await r.setFieldValue("action",i),r.handleSubmit()},q=()=>{v(b.instances.root(),{replace:!0})},be=N?N.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Ke,{title:t.jsxs("div",{className:z.headerContainer,children:[t.jsx("h2",{className:R("p-heading--4 u-no-padding--top",z.heading),children:e.title}),e.is_wsl_instance&&t.jsx(Oe,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:pe},{icon:"restart",label:"Restart",onClick:m,excluded:!c(e).power},{icon:"power-off",label:"Shut down",onClick:H,excluded:!c(e).power},{icon:"code",label:"Run script",onClick:he,excluded:!c(e).scripts},{icon:l.ICONS.user,label:"Associate employee",onClick:ge,collapsed:!0,excluded:!o("employee-management")||!c(e).employees||e.employee_id!==null},{icon:l.ICONS.user,label:"Disassociate employee",onClick:de,collapsed:!0,excluded:!o("employee-management")||!c(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:X,collapsed:!0,excluded:!c(e).uninstallation},{icon:"close",label:"Uninstall",onClick:se,collapsed:!0,excluded:!c(e).uninstallation},{icon:l.ICONS.delete,label:"Remove from Landscape",onClick:ie,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:re,collapsed:!0,excluded:!c(e).sanitization}]}},e.employee_id??"no-employee"),t.jsxs(M,{children:[t.jsx(M.Item,{title:"Status",children:t.jsxs(a,{children:[t.jsx(a.Item,{label:"Status",value:t.jsxs("div",{className:z.status,children:[t.jsx(l.Icon,{name:Q(e).icon??""}),t.jsx("span",{children:Q(e).label})]})}),t.jsx(a.Item,{label:"Last ping time",value:k(e.last_ping_time).isValid()?k(e.last_ping_time).format(W):null}),t.jsx(a.Item,{label:"Access group",value:be.find(i=>i.name===e.access_group)?.title||e.access_group}),t.jsx(a.Item,{label:"Tags",value:e.tags.join(", "),type:"truncated"}),t.jsx(a.Item,{label:"Profiles",value:e.profiles?.length?e.profiles.length===1?t.jsx(Xe,{profile:e.profiles[0]}):t.jsxs(l.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:ye,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),c(e).employees&&t.jsx(a.Item,{label:"Associated employee",value:f?.name})]})}),t.jsx(M.Item,{title:"Registration details",children:t.jsxs(a,{children:[t.jsx(a.Item,{label:"Hostname",value:e.hostname}),t.jsx(a.Item,{label:"ID",value:e.id}),c(e).hardware&&t.jsx(a.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),c(e).hardware&&t.jsx(a.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(a.Item,{label:"OS",value:e.distribution_info?.description}),c(e).hardware&&t.jsx(a.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(i=>i.ip).join(", "):null,type:"truncated"}),t.jsx(a.Item,{label:"Registered",value:k(e.registered_at).format(W)})]})}),t.jsx(M.Item,{title:"Other",children:t.jsxs(a,{children:[t.jsx(a.Item,{label:"Annotations",value:null}),t.jsx(a.Item,{label:"Comment",value:e.comment})]})})]}),g&&t.jsx(l.ConfirmationModal,{close:p,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:async()=>E("reboot"),children:t.jsxs(l.Form,{onSubmit:async()=>E("reboot"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:Y(r,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),I&&t.jsx(l.ConfirmationModal,{close:J,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:async()=>E("shutdown"),children:t.jsxs(l.Form,{onSubmit:async()=>E("shutdown"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:Y(r,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),ce&&t.jsx(l.ConfirmationModal,{close:$,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:fe,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",f?.name,". This will revoke their access to the instanceâ€™s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Ne,{close:ee,instances:[{name:e.title,computer_id:e.id}],isOpen:Z,windowsInstance:e}),t.jsx(qe,{close:oe,instances:[{name:e.title,computer_id:e.id}],isOpen:te,onSuccess:q,parentId:e.parent.id})]}),t.jsx(Ve,{close:le,instance:e,isOpen:ae,onSuccess:q}),t.jsx(Pe,{isOpen:ne,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:j,confirmButtonLoading:j,onConfirm:me,close:V,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},vt=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"}));export{Xe as P,vt as i};
