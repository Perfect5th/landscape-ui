const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-bBMqfjOT.js","assets/index-CmmfIHlE.js","assets/index-mAgDtnB8.css","assets/AssociationBlock-B74y9iIC.js","assets/MultiSelectField-C_l77q69.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-CChW5X3w.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-DmuqWUSv.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-Csuu2CdA.js","assets/FileInput-B74s4_B1.js","assets/useGetInstances-eoVUQy6E.js","assets/HeaderWithSearch-CXndOB4F.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SidePanelTablePagination-ByPcywwl.js","assets/TextConfirmationModal-DDnptHCt.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/PageMain-Cm2imCsJ.js","assets/PageMain-C_v2-kHh.css","assets/constants-B3UTGQVM.js","assets/constants-B3lPHYdf.js","assets/table-CdFwMAPu.js","assets/index-PU_JNssD.css"])))=>i.map(i=>d[i]);
import{k as w,d as D,i as F,l as p,m as S,O as j,z as k,f as i,B as y,ab as E,ar as I,at as Q,j as a,aA as O,S as V,J as L,R as M,av as H,s as K,t as z,n as A,a2 as U,a8 as B,aI as G,o as u,aD as W,e as P,aJ as J,aE as Y,E as X,a as Z,p as ee,ag as g,a0 as _}from"./index-CmmfIHlE.js";import{P as ae,a as se,b as te}from"./PageMain-Cm2imCsJ.js";import{H as ne}from"./HeaderWithSearch-CXndOB4F.js";import{L as ie}from"./constants-B3UTGQVM.js";import{L as re}from"./constants-B3lPHYdf.js";import{u as oe}from"./useRoles-Csuu2CdA.js";import{T as ce}from"./TextConfirmationModal-DDnptHCt.js";import{c as le}from"./table-CdFwMAPu.js";function q(){const e=w(),t=D(),o=F(),c=(n={},r={})=>S({queryKey:["packageProfiles",n],queryFn:async({signal:l})=>t.get("packageprofiles",{params:n,signal:l}),...r}),d=p({mutationFn:async n=>t.post("packageprofiles",n),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),v=p({mutationFn:async n=>t.post("packageprofiles",n),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),x=p({mutationFn:async n=>o.get("RemovePackageProfile",{params:n}),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),m=p({mutationFn:async({name:n,...r})=>t.put(`packageprofiles/${n}`,r),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),f=({instanceId:n,...r},l={})=>S({queryKey:["instancePackageProfiles",{instanceId:n,...r}],queryFn:async()=>t.get(`computers/${n}/packages/profile`,{params:r}),...l}),h=({name:n,...r},l={})=>S({queryKey:["packageProfileConstraints",{name:n,...r}],queryFn:async()=>t.get(`packageprofiles/${n}/constraints`,{params:r}),...l}),T=p({mutationFn:async({name:n,...r})=>t.post(`packageprofiles/${n}/constraints`,r),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),C=p({mutationFn:async({id:n,name:r,...l})=>t.put(`packageprofiles/${r}/constraints/${n}`,l),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),s=p({mutationFn:async({name:n,...r})=>t.delete(`packageprofiles/${n}/constraints`,{params:r}),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:T,copyPackageProfileQuery:d,createPackageProfileQuery:v,editPackageProfileConstraintQuery:C,editPackageProfileQuery:m,getInstancePackageProfileQuery:f,getPackageProfileConstraintsQuery:h,getPackageProfilesQuery:c,removePackageProfileConstraintsQuery:s,removePackageProfileQuery:x}}const N={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},De=Object.fromEntries(Object.keys(N).map(e=>[e,!0])),Fe={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},Qe=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],Ve=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],R=j().of(k().shape({constraint:i().required("Required."),notAnyVersion:y(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")}),version:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")})})).min(1,"Package profiles must have at least one package constraint."),Me={access_group:E,all_computers:!1,constraints:[N],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},He=k().shape({access_group:i(),all_computers:y(),constraints:j().when("constraintsType",{is:"manual",then:()=>R}),constraintsType:i().required("This field is required."),csvFile:Q().nullable().test({name:"mime-type",message:"Invalid file type.",test:e=>!e||e.type==="text/csv"}).when("constraintsType",{is:"material",then:e=>e.required("This field is required.")}),description:i().required("This field is required."),isCsvFileParsed:y(),material:i().when("constraintsType",{is:"material",then:e=>e.required("The file cannot be empty.")}),source_computer_id:I().when("constraintsType",{is:"instance",then:e=>e.min(1,"This field is required.")}),tags:j().of(i()),title:i().required("This field is required.")}),Ke=k().shape({constraints:R}),ze={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},Ue=k().shape({constraint:i().required("Required."),id:I(),notAnyVersion:y(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")}),version:i().when("notAnyVersion",(e,t)=>e[0]?t.required("Required."):t)}),de=({packageProfile:e})=>!e.tags.length&&!e.all_computers?a.jsx(O,{}):e.computers.constrained.length?a.jsxs(V,{to:M.instances.root({query:`profile:package:${e.id}`}),children:[e.computers.constrained.length," ",L(e.computers.constrained.length,"instance")]}):"0 instances",Be={access_group:E,all_computers:!1,description:"",tags:[],title:""},Ge=k().shape({access_group:i(),all_computers:y(),description:i(),tags:j().of(i()),title:i()}),We=k().shape({all_computers:y(),description:i(),tags:j().of(i()),title:i().required("This field is required")}),ue=()=>a.jsxs(a.Fragment,{children:[a.jsx(ne,{}),a.jsx(H,{filtersToDisplay:["search"]})]}),pe=({profile:e})=>{const t=K(),{notify:o}=z(),{setPageParams:c}=A(),{removePackageProfileQuery:d}=q(),{value:v,setTrue:x,setFalse:m}=U(),{mutateAsync:f,isPending:h}=d,T=()=>{c({sidePath:["edit-constraints"],profile:e.name})},C=()=>{c({sidePath:["edit"],profile:e.name})},s=()=>{c({sidePath:["duplicate"],profile:e.name})},n=async()=>{try{await f({name:e.name}),o.success({message:`Package profile "${e.title}" removed successfully`,title:"Package profile removed"})}catch($){t($)}finally{m()}},r=[{icon:"edit",label:"Edit","aria-label":`Edit ${e.title} profile`,onClick:C},{icon:"applications",label:"Change package constraints","aria-label":`Change ${e.title} package constraints`,onClick:T},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${e.title} profile`,onClick:s}],l=[{icon:"delete",label:"Remove","aria-label":`Remove ${e.title} profile`,onClick:x}];return a.jsxs(a.Fragment,{children:[a.jsx(B,{toggleAriaLabel:`${e.title} profile actions`,actions:r,destructiveActions:l}),a.jsx(ce,{isOpen:v,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:h,confirmButtonDisabled:h,close:m,confirmationText:`remove ${e.title}`,onConfirm:n,children:a.jsxs("p",{children:['This will remove "',e.title,'" profile. This action is'," ",a.jsx("b",{children:"irreversible"}),"."]})})]})},ge=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,Pe=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,{getCellProps:me,getRowProps:fe}=le({itemTypeName:"package profile",headerColumnId:"title"}),he="_description_y3fly_1",ye="_noWrap_y3fly_2",b={description:he,noWrap:ye},ke=({packageProfiles:e})=>{const{search:t,setPageParams:o}=A(),{getAccessGroupQuery:c}=oe(),{expandedRowIndex:d,handleExpand:v,getTableRowsRef:x}=G(),{data:m}=c(),f=m?.data.map(({name:s,title:n})=>({label:n,value:s}))??[],h=s=>{o({sidePath:["view"],profile:s.name})},T=u.useMemo(()=>t?e.filter(s=>s.title.toLowerCase().includes(t.toLowerCase())):e,[e,t]),C=u.useMemo(()=>[{...re,meta:{ariaLabel:({original:s})=>`${s.title} profile title and name`},Cell:({row:{original:s}})=>a.jsxs(W,{children:[a.jsx(P.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{h(s)},children:s.title}),a.jsx("span",{className:"u-text--muted",children:s.name})]})},{accessor:"description",className:b.description,Header:"Description",meta:{ariaLabel:({original:s})=>`${s.title} profile description`}},{accessor:"access_group",Header:"Access group",meta:{ariaLabel:({original:s})=>`${s.title} profile access group`},Cell:({row:{original:{access_group:s}}})=>f.find(({value:n})=>n===s)?.label??s},{accessor:"tags",Header:"Tags",meta:{ariaLabel:({original:s})=>`${s.title} profile tags`,isExpandable:!0},Cell:({row:{original:{tags:s},index:n}})=>s.length>0?a.jsx(J,{content:s.map(r=>a.jsx("span",{className:"truncatedItem",children:r},r)),isExpanded:n==d,onExpand:()=>{v(n)},showCount:!0}):a.jsx(O,{})},{accessor:"computers['non-compliant']",meta:{ariaLabel:({original:s})=>`${s.title} profile non-compliant instances`},Header:a.jsxs("div",{className:b.noWrap,children:[a.jsx("span",{children:"Not compliant "}),a.jsx(P.Tooltip,{position:"btm-left",message:ge,children:a.jsx(P.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>a.jsx(a.Fragment,{children:`${s.computers["non-compliant"].length} ${L(s.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",meta:{ariaLabel:({original:s})=>`${s.title} profile pending instances`},Header:a.jsxs("div",{className:b.noWrap,children:[a.jsx("span",{children:"Pending "}),a.jsx(P.Tooltip,{position:"btm-left",message:Pe,children:a.jsx(P.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>a.jsx(a.Fragment,{children:`${s.computers.pending?.length??0} ${L(s.computers.pending.length,"instance")}`})},{accessor:"computers['constrained']",meta:{ariaLabel:({original:s})=>`${s.title} profile constrained instances`},Header:"Associated",Cell:({row:{original:s}})=>a.jsx(de,{packageProfile:s})},{...ie,Cell:({row:{original:s}})=>a.jsx(pe,{profile:s})}],[f.length,d]);return a.jsx("div",{ref:x,children:a.jsx(Y,{columns:C,data:T,emptyMsg:`No package profiles found with the search "${t}"`,getCellProps:me(d),getRowProps:fe(d),minWidth:1200})})},_e=()=>{const{setPageParams:e}=A(),t=()=>{e({sidePath:["add"]})};return a.jsx(X,{body:a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"You havenâ€™t added any package profiles yet."}),a.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[a.jsx(P.Button,{type:"button",appearance:"positive",onClick:t,children:"Add package profile"},"add")],title:"No package profiles found"})},ve=({packageProfiles:e=[]})=>a.jsxs(a.Fragment,{children:[a.jsx(ue,{}),a.jsx(ke,{packageProfiles:e})]}),xe=()=>{const{getPackageProfilesQuery:e}=q(),{data:t,isLoading:o}=e();return a.jsxs(a.Fragment,{children:[o&&a.jsx(Z,{}),!o&&(!t||t.data.result.length===0)&&a.jsx(_e,{}),!o&&t&&t.data.result.length>0&&a.jsx(ve,{packageProfiles:t?.data.result})]})},Te=u.lazy(async()=>_(()=>import("./index-bBMqfjOT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>({default:e.PackageProfileAddSidePanel}))),Ce=u.lazy(async()=>_(()=>import("./index-bBMqfjOT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>({default:e.PackageProfileConstraintsAddSidePanel}))),je=u.lazy(async()=>_(()=>import("./index-bBMqfjOT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>({default:e.PackageProfileConstraintsEditSidePanel}))),Ae=u.lazy(async()=>_(()=>import("./index-bBMqfjOT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>({default:e.PackageProfileDetailsSidePanel}))),Se=u.lazy(async()=>_(()=>import("./index-bBMqfjOT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>({default:e.PackageProfileDuplicateSidePanel}))),be=u.lazy(async()=>_(()=>import("./index-bBMqfjOT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(e=>({default:e.PackageProfileEditSidePanel}))),Le=()=>{const{sidePath:e,lastSidePathSegment:t,setPageParams:o}=A();ee("sidePath",["add","add-constraints","duplicate","edit","edit-constraints","view"]);const c=()=>{o({sidePath:["add"],profile:""})};return a.jsxs(ae,{children:[a.jsx(se,{title:"Package profiles",actions:[a.jsx(P.Button,{type:"button",appearance:"positive",onClick:c,children:"Add package profile"},"add-package-profile")]}),a.jsx(te,{children:a.jsx(xe,{})}),a.jsxs(g,{onClose:()=>{o({sidePath:[],profile:""})},isOpen:!!e.length,size:["add","add-constraints","edit-constraints","view"].includes(t)?"medium":void 0,children:[t==="add"&&a.jsx(g.Suspense,{children:a.jsx(Te,{})},"add"),t==="add-constraints"&&a.jsx(g.Suspense,{children:a.jsx(Ce,{})},"add-constraints"),t==="duplicate"&&a.jsx(g.Suspense,{children:a.jsx(Se,{})},"duplicate"),t==="edit"&&a.jsx(g.Suspense,{children:a.jsx(be,{})},"edit"),t==="edit-constraints"&&a.jsx(g.Suspense,{children:a.jsx(je,{})},"edit-constraints"),t==="view"&&a.jsx(g.Suspense,{children:a.jsx(Ae,{})},"view")]})]})},Je=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Ve as C,N as E,Me as I,Fe as L,de as P,De as T,He as V,Qe as a,Ke as b,Ue as c,ze as d,Ge as e,Be as f,We as g,ue as h,ke as i,_e as j,Je as k,q as u};
