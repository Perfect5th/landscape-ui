const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BFbKA0Kk.js","assets/index-D0u57Pxb.js","assets/index-BPLQZu52.css","assets/HeaderWithSearch-BzhfaGcz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/CellInput-Cy6A0C-J.js","assets/SidePanelTablePagination-CHdtQP6d.js","assets/PageMain-DcafiL8-.js","assets/PageMain-CIunaku7.css","assets/useRoles-HG8FT5w2.js","assets/useExpandableRow-DzAp8CLA.js","assets/index-DkxMn-0U.css","assets/index-BBiVzY-B.js","assets/AssociationBlock-CRyI5Ij1.js","assets/MultiSelectField-CSHCVUD_.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-B2gUDXxz.js","assets/AssociationBlock-DQBJa-xL.css","assets/SidePanelFormButtons-D9Nkhm2q.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/index-DG-oCorT.js","assets/index-CHh-a3CG.js","assets/FileInput-BA27oZCO.js","assets/PackageProfileConstraintsBlock-DZFIKhti.js","assets/PackageProfileConstraintsBlock-CdyFUl7u.css","assets/index-CLnfUnnC.css"])))=>i.map(i=>d[i]);
import{i as B,c as H,h as K,k as b,l as N,M as I,a6 as G,P as y,U as $,Q as U,O as E,af as W,j as e,N as R,aF as Y,y as _,r as d,q as h,d as c,o as v,a2 as C,B as w,C as L,I as j,aa as F,H as J,ap as X,f as Z,aA as ee,ai as ae,aB as se,aC as te,aq as ne,ao as oe,E as ie}from"./index-D0u57Pxb.js";import{P as re,a as ce,b as le}from"./PageMain-DcafiL8-.js";import{u as q}from"./useRoles-HG8FT5w2.js";import{H as D}from"./HeaderWithSearch-BzhfaGcz.js";import{S as de}from"./SidePanelTablePagination-CHdtQP6d.js";import{u as ue}from"./useExpandableRow-DzAp8CLA.js";function T(){const a=B(),s=H(),i=K(),n=(o={},l={})=>N({queryKey:["packageProfiles",o],queryFn:async()=>s.get("packageprofiles",{params:o}),...l}),u=b({mutationFn:async o=>s.post("packageprofiles",o),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),r=b({mutationFn:async o=>s.post("packageprofiles",o),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),p=b({mutationFn:async o=>i.get("RemovePackageProfile",{params:o}),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),P=b({mutationFn:async({name:o,...l})=>s.put(`packageprofiles/${o}`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),f=({instanceId:o,...l},x={})=>N({queryKey:["instancePackageProfiles",{instanceId:o,...l}],queryFn:async()=>s.get(`computers/${o}/packages/profile`,{params:l}),...x}),g=({name:o,...l},x={})=>N({queryKey:["packageProfileConstraints",{name:o,...l}],queryFn:async()=>s.get(`packageprofiles/${o}/constraints`,{params:l}),...x}),m=b({mutationFn:async({name:o,...l})=>s.post(`packageprofiles/${o}/constraints`,l),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),k=b({mutationFn:async({id:o,name:l,...x})=>s.put(`packageprofiles/${l}/constraints/${o}`,x),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),t=b({mutationFn:async({name:o,...l})=>s.delete(`packageprofiles/${o}/constraints`,{params:l}),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:m,copyPackageProfileQuery:u,createPackageProfileQuery:r,editPackageProfileConstraintQuery:k,editPackageProfileQuery:P,getInstancePackageProfileQuery:f,getPackageProfileConstraintsQuery:g,getPackageProfilesQuery:n,removePackageProfileConstraintsQuery:t,removePackageProfileQuery:p}}const Q={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Ye=Object.fromEntries(Object.keys(Q).map(a=>[a,!0])),pe={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},ge=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],me=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],Je={access_group:G,all_computers:!1,constraints:[Q],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Xe=I().shape({access_group:y(),all_computers:E(),constraints:$().when("constraintsType",{is:"manual",then:a=>a.of(I().shape({constraint:y().required("Required."),notAnyVersion:E(),package:y().required("Required."),rule:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:y().required("This field is required."),csvFile:W().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:y().required("This field is required."),isCsvFileParsed:E(),material:y().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:U().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:$().of(y()),title:y().required("This field is required.")}),M=({packageProfile:a})=>!a.tags.length&&!a.all_computers?e.jsx(R,{}):a.computers.constrained.length?e.jsxs(Y,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:package:${a.id}`)}`},children:[a.computers.constrained.length," ",_(a.computers.constrained.length,"instance")]}):"0 instances",he="_constraint_1lz67_1",Pe="_hidden_1lz67_5",z={constraint:he,hidden:Pe},fe=({row:a,column:s})=>{const i={};return a.original.package==="loading"?s.id==="package"?i.colSpan=3:(i.className=z.hidden,i["aria-hidden"]=!0):s.id==="package"?i.role="rowheader":s.id==="constraint"?i["aria-label"]="Constraint":s.id==="rule"?i["aria-label"]="Rule":s.id==="version"&&(i["aria-label"]="Version"),i},ye=({isConstraintsLoading:a,profileConstraints:s,search:i})=>{const n=d.useMemo(()=>a?[pe]:s?s.map(r=>({...r,notAnyVersion:!!r.version})):[],[a,s]),u=d.useMemo(()=>[{accessor:"constraint",className:z.constraint,Header:"Constraint",Cell:({row:{original:r}})=>me.find(({value:p})=>p===r.constraint)?.label??r.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:r}})=>r.package==="loading"?e.jsx(h,{}):r.package},{accessor:"version",Header:"Version",Cell:({row:{original:r}})=>r.version?`${ge.find(({value:p})=>p===r.rule)?.label} ${r.version}`:"Any"}],[n]);return e.jsx(c.ModularTable,{columns:u,data:n,getCellProps:fe,emptyMsg:`No constraints found with the search: "${i}"`})},ke="_actions_nxngq_1",xe={actions:ke},je=d.lazy(()=>C(()=>import("./index-BFbKA0Kk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Ce=({profile:a})=>{const[s,i]=d.useState(1),[n,u]=d.useState(20),[r,p]=d.useState(""),{setSidePanelContent:P}=v(),{getPackageProfileConstraintsQuery:f}=T(),{data:g,isLoading:m}=f({name:a.name,limit:n,offset:(s-1)*n,search:r}),k=()=>{P(`Change "${a.title}" profile's constraints`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(je,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!r&&s===1&&n===20&&m&&e.jsx(h,{}),(r||s!==1||n!==20||!m&&g&&g.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:xe.actions,onSearch:t=>p(t),actions:e.jsx(c.Button,{className:"u-no-margin--bottom",type:"button",onClick:k,children:"Change package constraints"})}),e.jsx(ye,{isConstraintsLoading:m,profileConstraints:g?.data.results,search:r}),e.jsx(de,{currentPage:s,pageSize:n,paginate:t=>i(t),setPageSize:t=>u(t),totalItems:g?.data.count})]})]})},be=d.lazy(async()=>C(()=>import("./index-BBiVzY-B.js"),__vite__mapDeps([12,1,2,13,14,15,16,17,18,19,20,9,7,8,3,4,6,10]))),ve=d.lazy(async()=>C(()=>import("./index-DG-oCorT.js"),__vite__mapDeps([21,1,2,18,19,20,13,14,15,16,17,7,8,9,3,4,6,10]))),_e=({profile:a})=>{const[s,i]=d.useState(!1),n=w(),{notify:u}=L(),{closeSidePanel:r,setSidePanelContent:p}=v(),{removePackageProfileQuery:P}=T(),{getAccessGroupQuery:f}=q(),{data:g}=f(),m=g?.data??[],{mutateAsync:k,isPending:t}=P,o=()=>{i(!0)},l=()=>{i(!1)},x=async()=>{try{await k({name:a.name}),l(),r(),u.success({message:`Package profile "${a.name}" removed successfully.`,title:"Package profile removed"})}catch(A){l(),n(A)}},S=()=>{p("Edit package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ve,{profile:a})}))},V=()=>{p("Duplicate package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(be,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(c.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:V,children:[e.jsx(c.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(c.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:S,children:[e.jsx(c.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(c.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:o,"aria-label":`Remove ${a.title} package profile`,children:[e.jsx(c.Icon,{name:c.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(c.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Title",value:a.title})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Name",value:a.name})}),e.jsx(c.Col,{size:9,children:e.jsx(j,{label:"Description",value:a.description})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Access group",value:m.find(A=>A.name===a.access_group)?.title??a.access_group})}),e.jsx(c.Col,{size:9,children:e.jsx(j,{label:"Tags",...a.tags.length>0?{type:"truncated",value:a.tags.join(", ")}:{value:e.jsx(R,{})}})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Associated to",value:e.jsx(M,{packageProfile:a})})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Pending on",value:`${a.computers.pending?.length??0} ${_(a.computers.pending.length,"instance")}`})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} ${_(a.computers["non-compliant"].length,"instance")}`})})]}),e.jsx(Ce,{profile:a}),e.jsx(F,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:t,confirmButtonDisabled:t,close:l,confirmationText:`remove ${a.title}`,onConfirm:x,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Te=d.lazy(async()=>C(()=>import("./index-BFbKA0Kk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Se=d.lazy(async()=>C(()=>import("./index-BBiVzY-B.js"),__vite__mapDeps([12,1,2,13,14,15,16,17,18,19,20,9,7,8,3,4,6,10]))),Ae=d.lazy(async()=>C(()=>import("./index-DG-oCorT.js"),__vite__mapDeps([21,1,2,18,19,20,13,14,15,16,17,7,8,9,3,4,6,10]))),Ne=({profile:a})=>{const s=w(),{notify:i}=L(),{setSidePanelContent:n}=v(),{removePackageProfileQuery:u}=T(),{value:r,setTrue:p,setFalse:P}=J(),{mutateAsync:f,isPending:g}=u,m=()=>{n(`Change "${a.title}" profile's constraints`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Te,{profile:a})}),"medium")},k=()=>{n(`Edit "${a.title}" profile`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Ae,{profile:a})}))},t=()=>{n(`Duplicate "${a.title}" profile`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Se,{profile:a})}))},o=async()=>{try{await f({name:a.name}),i.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(S){s(S)}finally{P()}},l=[{icon:"edit",label:"Edit","aria-label":`Edit ${a.title} profile`,onClick:k},{icon:"applications",label:"Change package constraints","aria-label":`Change ${a.title} package constraints`,onClick:m},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${a.title} profile`,onClick:t}],x=[{icon:"delete",label:"Remove","aria-label":`Remove ${a.title} profile`,onClick:p}];return e.jsxs(e.Fragment,{children:[e.jsx(X,{toggleAriaLabel:`${a.title} profile actions`,actions:l,destructiveActions:x}),e.jsx(F,{isOpen:r,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:g,confirmButtonDisabled:g,close:P,confirmationText:`remove ${a.title}`,onConfirm:o,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Ee=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,Oe=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,Re=a=>({column:s,row:{index:i}})=>{const n={};switch(s.id){case"title":n.role="rowheader";break;case"description":n["aria-label"]="Description";break;case"access_group":n["aria-label"]="Access group";break;case"tags":n["aria-label"]="Tags",a===i&&(n.className="expandedCell");break;case"computers['non-compliant']":n["aria-label"]="Not compliant instances";break;case"computers['pending']":n["aria-label"]="Pending instances";break;case"computers['constrained']":n["aria-label"]="Associated instances";break;case"actions":n["aria-label"]="Actions";break}return n},Ie=a=>({index:s,original:i})=>{const n={};return a===s&&(n.className="expandedRow"),n["aria-label"]=`${i.title} package profile row`,n},$e="_description_y3fly_1",we="_noWrap_y3fly_2",O={description:$e,noWrap:we},Le=({packageProfiles:a})=>{const{search:s}=Z(),{setSidePanelContent:i}=v(),{getAccessGroupQuery:n}=q(),{expandedRowIndex:u,handleExpand:r,getTableRowsRef:p}=ue(),{data:P}=n(),f=P?.data.map(({name:t,title:o})=>({label:o,value:t}))??[],g=t=>{i(t.title,e.jsx(_e,{profile:t}),"medium")},m=d.useMemo(()=>s?a.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),k=d.useMemo(()=>[{...ee,Cell:({row:{original:t}})=>e.jsxs(se,{children:[e.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{g(t)},children:t.title}),e.jsx("span",{className:"u-text--muted",children:t.name})]})},{accessor:"description",className:O.description,Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:t}}})=>f.find(({value:o})=>o===t)?.label??t},{accessor:"tags",Header:"Tags",Cell:({row:{original:{tags:t},index:o}})=>t.length>0?e.jsx(te,{content:t.map(l=>e.jsx("span",{className:"truncatedItem",children:l},l)),isExpanded:o==u,onExpand:()=>{r(o)},showCount:!0}):e.jsx(R,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:O.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(c.Tooltip,{position:"btm-left",message:Ee,children:e.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers["non-compliant"].length} ${_(t.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:O.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(c.Tooltip,{position:"btm-left",message:Oe,children:e.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers.pending?.length??0} ${_(t.computers.pending.length,"instance")}`})},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:t}})=>e.jsx(M,{packageProfile:t})},{...ae,Cell:({row:{original:t}})=>e.jsx(Ne,{profile:t})}],[f.length,u]);return e.jsx("div",{ref:p,children:e.jsx(ne,{columns:k,data:m,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:Re(u),getRowProps:Ie(u),minWidth:1200})})},Fe=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(oe,{filtersToDisplay:["search"]})]}),qe=d.lazy(()=>C(()=>import("./index-CHh-a3CG.js").then(a=>a.i),__vite__mapDeps([22,1,2,13,14,15,16,17,18,19,20,9,23,24,5,25,26]))),De=()=>{const{setSidePanelContent:a}=v(),s=()=>{a("Add package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(qe,{})}),"medium")};return e.jsx(ie,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any package profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},Qe=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsx(Le,{packageProfiles:a})]}),Me=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:i}=a();return e.jsxs(e.Fragment,{children:[i&&e.jsx(h,{}),!i&&(!s||s.data.result.length===0)&&e.jsx(De,{}),!i&&s&&s.data.result.length>0&&e.jsx(Qe,{packageProfiles:s?.data.result})]})},ze=d.lazy(()=>C(()=>import("./index-CHh-a3CG.js").then(a=>a.a),__vite__mapDeps([22,1,2,13,14,15,16,17,18,19,20,9,23,24,5,25,26])).then(a=>({default:a.PackageProfileCreateForm}))),Ve=()=>{const{setSidePanelContent:a}=v(),s=()=>{a("Add package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ze,{})}),"medium")};return e.jsxs(re,{children:[e.jsx(ce,{title:"Package profiles",actions:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(le,{children:e.jsx(Me,{})})]})},Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{me as C,Q as E,Je as I,pe as L,Le as P,Ye as T,Xe as V,ge as a,Fe as b,De as c,Ze as i,T as u};
