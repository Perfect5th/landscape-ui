import{j as s,m as y,_ as v,f as P,z as x,$ as E,b as A,a0 as F,C as L,H as j,a2 as _,o as b,d as p,F as h}from"./index-DldVyDB7.js";import{A as q}from"./AvailableProviderList-Db1VBrkn.js";const k=({methods:e})=>{if(!e)return null;const t=!!(e.standalone_oidc.available&&e.standalone_oidc.enabled),o=!!(e.ubuntu_one.available&&e.ubuntu_one.enabled),g=!!(e.password.available&&e.password.enabled),r=!!(e.pam.available&&e.pam.enabled),c=e.oidc.available?e.oidc.configurations.filter(({enabled:u})=>u):[],n=g||r,l=o||t||e.oidc.configurations.length>0;return s.jsxs(s.Fragment,{children:[n&&s.jsx(T,{isIdentityAvailable:r}),l&&s.jsx(q,{isStandaloneOidcEnabled:t,isUbuntuOneEnabled:o,oidcProviders:c}),!n&&!l&&s.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},B=(e={})=>{const t=y(),[o]=v(),r=o.has("code")?"employee-access/login/methods":"login/methods",{data:c,isLoading:n,isError:l}=P({queryKey:["loginMethods"],queryFn:async()=>t.get(r),...e});return{loginMethods:c?.data??null,loginMethodsLoading:n,isLoginMethodsError:l}},S="_buttonRow_f3s21_1",M={buttonRow:S},T=({isIdentityAvailable:e})=>{const[t]=v(),o=x(),{signInWithEmailAndPasswordQuery:g}=E(),{redirectToExternalUrl:r,setAuthLoading:c,setUser:n}=A(),l=F(),u=t.get("redirect-to"),w=t.has("external"),{mutateAsync:f}=g,i=L({initialValues:{email:"",password:""},validationSchema:j().shape({email:e?b().required("This field is required"):b().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:m=>{if(m.match(/\.\./))return!1;const[a,d]=m.split("@");return!(!a||!d||a.startsWith(".")||a.endsWith(".")||!d.includes(".")||d.startsWith(".")||d.startsWith("-")||d.match(/\.-/)||d.match(/-\./))}}),password:b().required("This field is required")}),onSubmit:async m=>{try{const{data:a}=await f({email:m.email,password:m.password});w&&u?r(u,{replace:!0}):("current_account"in a&&(c(!0),n(a)),l(u??_,{replace:!0}))}catch(a){o(a)}}});return s.jsxs(p.Form,{onSubmit:i.handleSubmit,children:[s.jsx(p.Input,{type:"text",label:e?"Identity":"Email",error:h(i,"email"),...i.getFieldProps("email"),"data-testid":"email"}),s.jsx(p.PasswordToggle,{id:"password",label:"Password",error:h(i,"password"),...i.getFieldProps("password"),"data-testid":"password"}),s.jsx("div",{className:M.buttonRow,children:s.jsx(p.Button,{type:"submit",appearance:"positive",disabled:i.isSubmitting||!i.isValid,className:"u-no-margin--bottom",children:"Sign in"})})]})};export{k as L,B as u};
